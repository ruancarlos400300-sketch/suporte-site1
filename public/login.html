<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOGIN | ORBITRON EB</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="/firebase-config.js"></script>
    <script src="/logs.js"></script>
</head>
<body>

    <div class="card-militar">
        <img src="https://i.imgur.com/8Y6E7Gv.png" width="70" style="margin-bottom: 20px;">
        <h1>Identifica√ß√£o Militar</h1>
        <p>Acesse o painel t√°tico com sua chave de servi√ßo.</p>

        <div class="input-group">
            <label>Chave de Acesso</label>
            <input type="text" id="access-key" placeholder="ORB-XXXX-XXXX-XXXX-XXXX" style="text-align: center; font-family: monospace;">
        </div>

        <button class="btn-eb" onclick="autenticar()">AUTENTICAR NO QG</button>

        <div style="margin-top: 25px;">
            <a href="/" style="color: var(--eb-ouro); text-decoration: none; font-size: 13px; font-weight: bold;">‚Üê VOLTAR AO POSTO DE ATENDIMENTO</a>
        </div>
    </div>

    <script>
        function autenticar() {
            const chave = document.getElementById('access-key').value.trim().toUpperCase();
            if(!chave) return;

            db.ref('logins_gerados/' + chave).once('value', snap => {
                const d = snap.val();
                if(d) {
                    db.ref('usuarios/' + chave).update({ nome: d.responsavel, cargo: d.cargo }).then(() => {
                        localStorage.setItem('militar_chave', chave);
                        enviarLog("üöÄ MILITAR ONLINE", [
                            { name: "Soldado", value: d.responsavel, inline: true },
                            { name: "Patente", value: d.cargo.toUpperCase(), inline: true }
                        ], 3447003);
                        window.location.href = (d.cargo === 'dono') ? '/dono' : '/admin';
                    });
                } else {
                    alert("ACESSO NEGADO: Chave n√£o reconhecida pelo Alto Comando.");
                }
            });
        }
    </script>
</body>
</html>
