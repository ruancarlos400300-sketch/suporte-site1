<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>LOGIN STAFF | ORBITRON</title>
    
    <link rel="stylesheet" href="/styles.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="/firebase-config.js"></script>

    <style>
        /* Ajuste específico para destacar o campo de login */
        .login-card input:focus {
            transform: scale(1.03); /* Leve "zoom" visual no campo ao clicar */
            border-color: var(--discord-blue);
            box-shadow: 0 0 15px rgba(88, 101, 242, 0.3);
            transition: all 0.3s ease;
        }
        
        .login-card input {
            transition: all 0.3s ease;
            text-transform: uppercase; /* Força visual de chave militar */
        }
    </style>
</head>
<body>

    <div class="login-card">
        <h2>Acesso Militar</h2>
        <p>Insira sua chave de acesso gerada pelo Comando para autenticar seu perfil.</p>
        
        <input type="text" id="access-key" placeholder="ORB-XXXXXXXX" autocomplete="off">
        
        <button class="btn-blue" onclick="autenticar()">AUTENTICAR ACESSO</button>
        
        <a href="/" class="link" style="display: block; margin-top: 20px; font-size: 13px;">
            ← Voltar ao Suporte Player
        </a>
    </div>

    <script>
        function autenticar() {
            const chave = document.getElementById('access-key').value.trim().toUpperCase();
            
            if(!chave) {
                alert("Erro: A chave de acesso é obrigatória.");
                return;
            }

            // Busca a chave no banco de dados
            db.ref('logins_gerados/' + chave).once('value', snap => {
                const dados = snap.val();
                
                if(dados) {
                    // Atualiza ou cria o perfil do usuário vinculado à chave
                    db.ref('usuarios/' + chave).update({
                        nome: dados.responsavel,
                        cargo: dados.cargo
                    }).then(() => {
                        // Salva a chave localmente para manter o login
                        localStorage.setItem('militar_chave', chave);
                        
                        // Redirecionamento inteligente baseado no cargo
                        if(dados.cargo === 'dono') {
                            window.location.href = '/dono';
                        } else {
                            window.location.href = '/admin';
                        }
                    });
                } else {
                    alert("Acesso Negado: Chave inválida, expirada ou não encontrada no sistema.");
                }
            });
        }

        // Permitir login ao apertar "Enter"
        document.getElementById('access-key').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') autenticar();
        });
    </script>
</body>
</html>
