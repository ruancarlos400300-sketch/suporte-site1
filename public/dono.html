<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>COMANDO SUPREMO | ORBITRON</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="/firebase-config.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family: sans-serif; }
        body { background:#020617; color:white; display:flex; flex-direction:column; align-items:center; padding:50px; }
        .card { background:#0f172a; border:1px solid #1e293b; padding:25px; border-radius:15px; width:100%; max-width:800px; }
        h1 { color:#5865F2; margin-bottom:30px; text-transform:uppercase; letter-spacing:2px; }
        table { width:100%; border-collapse: collapse; margin-top:20px; }
        th, td { padding:15px; text-align:left; border-bottom:1px solid #1e293b; }
        th { color:#64748b; font-size:12px; text-transform:uppercase; }
        .btn-add { background:#10b981; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-weight:bold; }
        .btn-edit { background:#5865F2; color:white; border:none; padding:5px 10px; border-radius:3px; cursor:pointer; margin-right:5px; }
        input { background:#020617; border:1px solid #334155; color:white; padding:10px; border-radius:5px; margin-right:10px; }
    </style>
</head>
<body>

    <h1>Painel de Controle do Dono</h1>

    <div class="card">
        <h3>Gerenciar Membros da Staff</h3>
        <table id="tabela-membros">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Cargo</th>
                    <th>Pontos</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="corpo-tabela">
                </tbody>
        </table>
    </div>

    <script>
        // TRAVA DE SEGURANÇA: Só o 'dono' entra aqui
        auth.onAuthStateChanged(user => {
            if (user) {
                db.ref('usuarios/' + user.uid).once('value', snap => {
                    const d = snap.val();
                    if (!d || d.cargo !== 'dono') {
                        alert("ACESSO NEGADO: Apenas o Dono pode acessar esta página.");
                        window.location.href = 'admin.html';
                    }
                });
            } else { window.location.href = 'login.html'; }
        });

        // CARREGAR LISTA DE MILITARES
        db.ref('usuarios').on('value', snap => {
            const tbody = document.getElementById('corpo-tabela');
            tbody.innerHTML = "";
            snap.forEach(membro => {
                const m = membro.val();
                const id = membro.key;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${m.nome}</td>
                    <td><span style="color:#5865F2">${m.cargo}</span></td>
                    <td><strong>${m.pontos}</strong></td>
                    <td>
                        <button class="btn-edit" onclick="alterarPontos('${id}', 100)">+100</button>
                        <button class="btn-edit" onclick="alterarPontos('${id}', -100)" style="background:#ef4444">-100</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });

        function alterarPontos(uid, valor) {
            const ref = db.ref('usuarios/' + uid + '/pontos');
            ref.transaction(ptsAtual => {
                return (ptsAtual || 0) + valor;
            });
        }
    </script>
</body>
</html>
