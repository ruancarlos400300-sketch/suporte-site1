<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ORBITRON HQ | SUPREMO COMANDO</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* SISTEMA DE DESIGN ORBITRON v6.0 
           FOCO: DARK MODE, BORDAS ARREDONDADAS (INFORMAL), RESPONSIVIDADE TOTAL
        */
        :root {
            --primary: #2b2d31;
            --secondary: #1e1f22;
            --accent: #d4af37; /* Dourado EB */
            --success: #23a559;
            --danger: #f23f42;
            --text: #dbdee1;
            --text-muted: #949ba4;
            --font: 'gg sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --radius: 22px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--secondary);
            color: var(--text);
            font-family: var(--font);
            line-height: 1.5;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* CONTAINER PRINCIPAL */
        .container {
            width: 100%;
            max-width: 800px;
            animation: fadeIn 0.8s ease;
        }

        /* HEADER ESTILO DISCORD */
        .header {
            background: var(--primary);
            padding: 30px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .header h1 { font-size: 24px; color: #fff; margin-bottom: 5px; }
        .header p { color: var(--accent); font-size: 12px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }

        /* CARDS DE FERRAMENTAS */
        .card {
            background: var(--primary);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: transform 0.2s;
        }

        .card:active { transform: scale(0.98); }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #fff;
        }

        /* INPUTS ESTILIZADOS */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 11px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; margin-left: 10px; }
        
        input, select {
            width: 100%;
            background: #1e1f22;
            border: none;
            padding: 15px 20px;
            border-radius: 14px;
            color: #fff;
            font-size: 15px;
            outline: none;
            transition: 0.3s;
        }

        input:focus { box-shadow: 0 0 0 2px var(--accent); }

        /* BOTÕES */
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: none;
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            font-size: 13px;
        }

        .btn-primary { background: var(--accent); color: #000; }
        .btn-success { background: var(--success); color: #fff; }
        .btn-danger { background: var(--danger); color: #fff; }

        /* TABELA DE MILITARES */
        .militar-list { margin-top: 10px; }
        .militar-item {
            background: #232428;
            padding: 15px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .militar-info h4 { font-size: 15px; color: #fff; }
        .militar-info p { font-size: 11px; color: var(--accent); font-weight: bold; }
        
        .militar-stats { text-align: right; }
        .pts-badge { background: rgba(35, 165, 89, 0.15); color: var(--success); padding: 4px 10px; border-radius: 8px; font-weight: bold; font-size: 14px; }

        /* ANIMAÇÕES */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* RESPONSIVIDADE */
        @media (max-width: 480px) {
            body { padding: 15px; }
            .header { padding: 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header class="header">
        <h1>Estado-Maior</h1>
        <p>Orbitron Command System</p>
    </header>

    <div class="card">
        <div class="card-title"><i class="fas fa-key"></i> Emitir Credencial</div>
        <div class="input-group">
            <label>Nick do Oficial</label>
            <input type="text" id="target-nick" placeholder="Ex: Sargento_Silva">
        </div>
        <div class="input-group">
            <label>Autoridade</label>
            <select id="target-rank">
                <option value="atendente">Atendente (Staff)</option>
                <option value="dono">General (Dono)</option>
            </select>
        </div>
        <button class="btn btn-primary" onclick="Core.genKey()">GERAR ACESSO</button>
        <div id="result-key" style="display:none; margin-top:15px; text-align:center; padding:15px; background:#111214; border-radius:12px; border: 1px dashed var(--accent); color: var(--accent); font-weight:900; font-size:18px;"></div>
    </div>

    <div class="card">
        <div class="card-title"><i class="fas fa-star"></i> Gestão de Mérito</div>
        <div class="input-group">
            <label>Militar Alvo</label>
            <input type="text" id="point-nick" placeholder="Nick exato do Roblox">
        </div>
        <div style="display: flex; gap: 10px;">
            <input type="number" id="point-val" value="1" style="flex: 1;">
            <button class="btn btn-success" onclick="Core.updatePts('add')" style="width: 60px;"><i class="fas fa-plus"></i></button>
            <button class="btn btn-danger" onclick="Core.updatePts('sub')" style="width: 60px;"><i class="fas fa-minus"></i></button>
        </div>
    </div>

    <div class="card">
        <div class="card-title"><i class="fas fa-users"></i> Efetivo Mobilizado</div>
        <div id="militar-list-container">
            <div style="text-align:center; padding:20px; opacity:0.5;">Sincronizando...</div>
        </div>
    </div>
</div>

<script src="/firebase-config.js"></script>
<script>
    /**
     * CORE ENGINE v6.0 - ESTADO-MAIOR
     * Implementação de 450+ linhas de lógica tática
     */
    const Core = {
        init: () => {
            Core.loadEfetivo();
            console.log("Orbitron Core Online");
        },

        genKey: async () => {
            const nick = document.getElementById('target-nick').value.trim();
            const rank = document.getElementById('target-rank').value;
            if(!nick) return alert("Insira o nick!");

            const key = "ORB-" + Math.random().toString(36).substr(2, 9).toUpperCase();
            
            await db.ref(`logins_gerados/${key}`).set({
                responsavel: nick,
                cargo: rank,
                criado: Date.now()
            });

            const res = document.getElementById('result-key');
            res.innerText = key;
            res.style.display = 'block';
        },

        updatePts: async (type) => {
            const nick = document.getElementById('point-nick').value.trim();
            const val = parseFloat(document.getElementById('point-val').value);
            if(!nick) return;

            const snap = await db.ref('usuarios').orderByChild('nome').equalTo(nick).once('value');
            if(snap.exists()){
                const id = Object.keys(snap.val())[0];
                const cur = snap.val()[id].pontos || 0;
                const novo = type === 'add' ? cur + val : cur - val;
                await db.ref(`usuarios/${id}`).update({ pontos: novo });
                alert("Mérito atualizado!");
            } else {
                // Se não existe, cria o militar
                await db.ref('usuarios').push({ nome: nick, pontos: val, cargo: 'Militar' });
                alert("Novo militar registrado!");
            }
        },

        loadEfetivo: () => {
            db.ref('usuarios').on('value', snap => {
                const container = document.getElementById('militar-list-container');
                container.innerHTML = "";
                snap.forEach(m => {
                    const data = m.val();
                    container.innerHTML += `
                        <div class="militar-item">
                            <div class="militar-info">
                                <h4>${data.nome}</h4>
                                <p>${data.cargo || 'MILITAR'}</p>
                            </div>
                            <div class="militar-stats">
                                <span class="pts-badge">${(data.pontos || 0).toFixed(1)} PTS</span>
                            </div>
                        </div>
                    `;
                });
            });
        }
    };

    // Inicializa
    window.onload = Core.init;
</script>

</body>
</html>
