<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>SUPORTE | ORBITRON</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="/firebase-config.js"></script>
    <style>
        body { background:#020617; color:white; font-family:sans-serif; text-align:center; padding-top:100px; }
        .btn { background:#5865F2; color:white; padding:20px 40px; border-radius:50px; border:none; font-weight:bold; cursor:pointer; font-size:18px; }
        #chat-player { width:350px; margin:20px auto; background:#0f172a; padding:20px; border-radius:10px; display:none; border:1px solid #1e293b; }
        .msgs { height:200px; overflow-y:auto; text-align:left; margin-bottom:10px; }
        input { width:100%; padding:10px; border-radius:5px; border:none; }
    </style>
</head>
<body>
    <div id="inicial">
        <h1>SUPORTE ORBITRON</h1>
        <button class="btn" onclick="comecar()">COMEÃ‡AR ATENDIMENTO</button>
    </div>

    <div id="chat-player">
        <div class="msgs" id="msgs"></div>
        <input type="text" id="msg-input" placeholder="Diga algo...">
    </div>

    <script>
        let meuTicket = null;

        function comecar() {
            const n = prompt("Seu Nick:");
            if(!n) return;
            
            const ref = db.ref('tickets').push();
            meuTicket = ref.key;
            ref.set({ nick: n, status: 'aberto' }).then(() => {
                document.getElementById('inicial').style.display = 'none';
                document.getElementById('chat-player').style.display = 'block';
                escutarMensagens();
            });
        }

        function escutarMensagens() {
            db.ref('tickets/' + meuTicket + '/mensagens').on('child_added', snap => {
                const m = snap.val();
                const div = document.createElement('div');
                div.innerHTML = `<b>${m.autor}:</b> ${m.texto}`;
                document.getElementById('msgs').appendChild(div);
            });
        }

        document.getElementById('msg-input').addEventListener('keypress', e => {
            if (e.key === 'Enter' && meuTicket) {
                db.ref('tickets/' + meuTicket + '/mensagens').push({
                    autor: 'player',
                    texto: e.target.value
                });
                e.target.value = "";
            }
        });
    </script>
</body>
</html>
