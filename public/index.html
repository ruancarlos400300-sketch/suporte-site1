<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suporte EB | Orbitron</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body style="background-color: #020617; margin: 0; font-family: sans-serif;">

    <div id="step-1" style="height: 100vh; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; background-color: #020617;">
        
        <h1 style="color: white; font-size: 40px; font-weight: 900; margin-bottom: 30px; max-width: 600px; padding: 0 20px;">
            VOCÊ PRECISA DE SUPORTE NO NOSSO EB?
        </h1>

        <button onclick="proximo()" style="background-color: #4f46e5; color: white; border: none; padding: 20px 60px; border-radius: 50px; font-size: 20px; font-weight: 800; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.3);">
            COMEÇAR
        </button>

        <div style="margin-top: 40px !important; display: block !important;">
            <a href="/login.html" style="color: #64748b !important; text-decoration: underline !important; font-size: 14px !important; font-weight: bold !important; text-transform: uppercase !important; letter-spacing: 2px !important; display: inline-block !important;">
                ENTRAR COMO CAC...
            </a>
        </div>
        
    </div>

    <div id="step-2" style="display:none; height: 100vh; width: 100%; align-items: center; justify-content: center; background-color: #0f172a;">
        <div id="form-triagem" style="width: 90%; max-width: 400px; background: #1e293b; padding: 30px; border-radius: 20px;">
            <h2 style="color: white; margin-bottom: 20px;">TRIAGEM</h2>
            <input type="text" id="nick" placeholder="NICK DISCORD" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px; border:none; background:#020617; color:white;">
            <textarea id="prob" placeholder="QUAL O PROBLEMA?" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px; border:none; background:#020617; color:white; height:100px;"></textarea>
            <button onclick="conectar()" style="width:100%; padding:15px; background:#4f46e5; color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">ABRIR CHAMADO</button>
        </div>

        <div id="chat-box" style="display:none; width: 95%; max-width: 600px; height: 80vh; background: #1e293b; border-radius: 20px; flex-direction: column; padding: 20px;">
            <div id="msgs" style="flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; gap:10px; color:white;"></div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="text" id="input-msg" style="flex:1; padding:15px; border-radius:10px; border:none; background:#020617; color:white;">
                <button onclick="enviar()" style="padding:15px; background:#4f46e5; color:white; border:none; border-radius:10px; font-weight:bold;">ENVIAR</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        function proximo() { 
            document.getElementById('step-1').style.display = 'none'; 
            document.getElementById('step-2').style.display = 'flex'; 
        }
        function conectar() {
            const nick = document.getElementById('nick').value;
            if(!nick) return alert("Insira seu nick!");
            socket.emit('solicitar_suporte', { nick, problema: document.getElementById('prob').value });
            document.getElementById('form-triagem').style.display = 'none';
            document.getElementById('chat-box').style.display = 'flex';
        }
        function enviar() {
            const i = document.getElementById('input-msg');
            if(!i.value) return;
            socket.emit('enviar_mensagem', { texto: i.value, remetente: 'PLAYER' });
            i.value = '';
        }
        socket.on('receber_mensagem', (d) => {
            const b = document.getElementById('msgs');
            const align = d.remetente === 'PLAYER' ? 'align-self: flex-end; background: #4f46e5;' : 'align-self: flex-start; background: #334155;';
            b.innerHTML += `<div style="padding:10px 15px; border-radius:15px; max-width:80%; ${align}"><b>${d.remetente}:</b><br>${d.texto}</div>`;
            b.scrollTop = b.scrollHeight;
        });
        socket.on('atendimento_encerrado', () => { alert("Atendimento finalizado."); location.reload(); });
    </script>
</body>
</html>
