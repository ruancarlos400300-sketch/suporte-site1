<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EB Suporte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #020617; font-family: sans-serif; overflow: hidden; }
        .slide-up { transform: translateY(-100vh); transition: 0.7s ease-in-out; }
        @media (max-width: 600px) { h1 { font-size: 1.5rem !important; } }
    </style>
</head>
<body>
    <div id="step-1" class="h-screen w-full flex flex-col items-center justify-center bg-slate-950 absolute z-50">
        <h1 class="text-white text-3xl font-black mb-10 text-center px-4">VOCÃŠ PRECISA DE SUPORTE NO NOSSO EB?</h1>
        <button onclick="iniciar()" class="bg-indigo-600 text-white px-12 py-5 rounded-full font-bold text-lg mb-6">COMECAR</button>
        <a href="/login.html" class="text-slate-500 text-[10px] font-bold uppercase tracking-widest">Entrar como CAC...</a>
    </div>

    <div id="step-2" class="h-screen w-full bg-slate-900 flex flex-col items-center justify-center p-6">
        <div id="form" class="w-full max-w-md space-y-4">
            <input id="n" placeholder="NICK DISCORD" class="w-full p-4 bg-black/40 text-white rounded-xl outline-none border border-white/5">
            <textarea id="p" placeholder="QUAL O PROBLEMA?" class="w-full p-4 bg-black/40 text-white rounded-xl outline-none border border-white/5 h-32"></textarea>
            <button onclick="abrir()" class="w-full bg-indigo-600 py-4 rounded-xl text-white font-bold">ABRIR CHAT</button>
        </div>
        <div id="chat" class="hidden w-full max-w-2xl h-[80vh] bg-black/20 rounded-3xl p-4 flex flex-col">
            <div id="ms" class="flex-1 overflow-y-auto p-2 space-y-4"></div>
            <div class="flex gap-2 mt-4">
                <input id="in" class="flex-1 p-4 bg-white/5 text-white rounded-xl outline-none">
                <button onclick="send()" class="bg-indigo-600 px-6 rounded-xl text-white">ENVIAR</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        function iniciar() { document.getElementById('step-1').classList.add('slide-up'); }
        function abrir() {
            socket.emit('solicitar_suporte', { nick: document.getElementById('n').value, problema: document.getElementById('p').value });
            document.getElementById('form').style.display = 'none';
            document.getElementById('chat').classList.remove('hidden');
        }
        function send() {
            const i = document.getElementById('in');
            socket.emit('enviar_mensagem', { texto: i.value, remetente: 'PLAYER' });
            i.value = '';
        }
        socket.on('receber_mensagem', (d) => {
            const b = document.getElementById('ms');
            b.innerHTML += `<div class="p-3 rounded-xl ${d.remetente=='PLAYER'?'bg-indigo-600 ml-auto':'bg-white/10'} max-w-[80%] text-white text-sm">${d.texto}</div>`;
            b.scrollTop = b.scrollHeight;
        });
        socket.on('solicitar_avaliacao', () => { /* Abriria o modal de estrelas aqui */ alert("Avalie o atendimento (1-5)"); socket.emit('avaliar_atendimento', {estrelas: 5}); });
        socket.on('atendimento_encerrado', () => { location.reload(); });
    </script>
</body>
</html>
