<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suporte EB | Orbitron</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div id="step-1" class="screen-full">
        <h1 class="title-heavy">VOCÊ PRECISA DE SUPORTE NO NOSSO EB?</h1>
        <button class="btn-main" onclick="proximo()">COMEÇAR</button>
        <a href="/login.html" class="link-cac">Entrar como CAC...</a>
    </div>

    <div id="step-2" class="screen-full" style="display:none; background:#0f172a;">
        <div id="form-triagem" class="chat-container" style="height:auto; padding:2rem; gap:1rem;">
            <h2 style="margin-bottom:1rem; color:#818cf8;">TRIAGEM MILITAR</h2>
            <input type="text" id="nick" placeholder="NICK DO DISCORD">
            <textarea id="prob" placeholder="DESCREVA SEU PROBLEMA" style="height:120px;"></textarea>
            <button class="btn-main" onclick="conectar()">ABRIR CHAMADO</button>
        </div>

        <div id="chat-box" class="chat-container" style="display:none;">
            <div id="msgs" class="chat-messages"></div>
            <div style="padding:1rem; display:flex; gap:0.5rem; background:rgba(0,0,0,0.2);">
                <input type="text" id="input-msg" placeholder="Sua dúvida...">
                <button class="btn-main" style="padding:1rem 2rem;" onclick="enviar()">ENVIAR</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        function proximo() { document.getElementById('step-1').style.display='none'; document.getElementById('step-2').style.display='flex'; }
        function conectar() {
            const nick = document.getElementById('nick').value;
            if(!nick) return alert("Insira seu nick!");
            socket.emit('solicitar_suporte', { nick, problema: document.getElementById('prob').value });
            document.getElementById('form-triagem').style.display='none';
            document.getElementById('chat-box').style.display='flex';
        }
        function enviar() {
            const i = document.getElementById('input-msg');
            if(!i.value) return;
            socket.emit('enviar_mensagem', { texto: i.value, remetente: 'PLAYER' });
            i.value = '';
        }
        socket.on('receber_mensagem', (d) => {
            const b = document.getElementById('msgs');
            const cl = d.remetente === 'PLAYER' ? 'message-player' : 'message-staff';
            b.innerHTML += `<div class="message ${cl}"><b>${d.remetente}:</b><br>${d.texto}</div>`;
            b.scrollTop = b.scrollHeight;
        });
        socket.on('atendimento_encerrado', () => { alert("Sessão finalizada."); location.reload(); });
    </script>
</body>
</html>
